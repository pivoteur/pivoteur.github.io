<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pivot Protocol Pools</title>
    <link rel="stylesheet" href="styles.css"></link>
</head>

<body>
   <h1>Pivot Pool Management</h1>
   <h2>Pivot Pools</h2>

  <table border="1" width="100%" id="poolTable">
   <tr>
    <th>Pool Name</th><th>incept</th><th>TVL</th><th>ROI</th><th>APR</th>
   </tr>

   <!-- data for pools inserted here via javascript -->

   <tr><td colspan='6'><hr/></td></tr>
   <tr><th colspan='6'>Non-pool stakes</th></tr>

   <!-- data for treasure and echo pool inserted here -->

  </table>

  <p style="vertical-align:bottom">
   <a href='#'
      onclick='window.top.location.href = "https://github.com/pivoteur/biz/blob/main/README.md#1-the-pivot-pools";'>
Learn more <img src='imgs/leave-site.png' width='16'/></a> 
about the Pivot pools.<br/>
   <a href='#'
      onclick='window.top.location.href = "https://github.com/pivoteur/biz/blob/main/articles/staking.md";'>
Learn more <img src='imgs/leave-site.png' width='16'/></a>
about amplified staking.
  </p>

<script src="libs/table.js"></script>
<script>

const poolRow = (pool, row, idx, hrefIx) => {
   return {
      pool: pool,
      href: row[hrefIx],
      incept: row[idx['incept']],
      roi: row[idx['ROI']],
      apr: row[idx['APR']],
      tvl: row[idx['TVL']]
   };
};

const datum = (row, ix, txt) => {
   let cell = row.insertCell(ix);
   cell.innerHTML = txt;
};

const pivotTR = (tableId, rowIx, row) => {
  // ooh! DOM-manipulation henceforth!
  let table = document.getElementById(tableId);
  let tr = table.insertRow(rowIx); // remember: we already have a header row
  let { pool, href, incept, roi, apr, tvl } = row;
  datum(tr, 0, "<a href='" + href + "'>" + pool + "</a>");
  datum(tr, 1, incept);
  datum(tr, 2, tvl);
  datum(tr, 3, roi);
  datum(tr, 4, apr);
};

fetch('data/wallets.tsv').then(result => result.text()).then(data => {
   const pools = [];
   const nonPools = [];

   let [wallets, idx] = table(data);
   let hrefIx = idx['href'];
   let poolRows = wallets.filter(row => row[hrefIx] !== 'n/a');
   poolRows.forEach(row => {
      let pool = row[idx['pool']];
      if(pool === 'n/a') {
         nonPools.push(poolRow(row[idx['dapp']], row, idx, hrefIx));
      } else { pools.push(poolRow(pool, row, idx, hrefIx)); }
   });
   let rowIx = 1;
   pools.forEach(row => pivotTR("poolTable", rowIx++, row));
   let stakeIx = rowIx + 2; // to hop over the horizontal rule
   nonPools.forEach(row => pivotTR("poolTable", stakeIx++, row));
});

</script>

</body>
</html>
